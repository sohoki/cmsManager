<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="aten.com.backoffice.sts.xml.mapper.XmlInfoManagerMapper">
	<select id="selectXmlInfoManageListByPagination" resultType="XmlInfoVO">
		SELECT TB.*
		FROM 
		(
			SELECT 
				SUM(1) OVER(PARTITION BY NULL) AS TOTAL_RECORD_COUNT, ROWNUM RNUM, X.*
			FROM 
			(
				SELECT 
					A.XML_SEQ, A.WORK_GUBUN, A.XML_PROCESS_NAME, A.PROCESS_REMARK, A.XML_INPUTPARAM, 
					A.XML_OTPUTPARAM, A.TEST_OK, B.CODE_NM, FN_DETAILCODENM(A.SEND_GUBUN) AS sendGubunTxt
				FROM TB_SENDMESSAGETYPR A, LETTCCMMNDETAILCODE B
				WHERE A.WORK_GUBUN = B.CODE
				<if test="searchKeyword != ''">
					<choose>
						<when test="searchCondition == 'xmlProcessName'">
							AND XML_PROCESS_NAME LIKE '%' || #{searchKeyword} || '%'
						</when>
						<otherwise>
							AND PROCESS_REMARK LIKE '%' || #{searchKeyword} || '%'
						</otherwise>
					</choose>
				</if>
				<if test="seachWorkGubun != ''">
					AND A.WORK_GUBUN = #{seachWorkGubun}
				</if>
				ORDER BY A.XML_SEQ DESC
			) X
		) TB
		WHERE RNUM BETWEEN #{firstIndex} + 1 AND #{firstIndex} + #{recordCountPerPage}
		ORDER BY TB.XML_SEQ DESC
	</select>

	<select id="selectXmlrInfoManageDetail" resultType="XmlInfoVO">
		SELECT 
			A.XML_SEQ AS xmlSeq, A.WORK_GUBUN AS workGubun, A.XML_PROCESS_NAME AS xmlProcessName, A.PROCESS_REMARK AS processRemark, A.XML_INPUTPARAM as xmlInputParam, 
			A.XML_OTPUTPARAM AS xmlOutputParam, A.RESULT_CODE_EXAMPLE as resultCodeExample, A.ETC1 AS etc1, A.ETC2 AS etc2, A.ETC3 AS etc3,
			A.TEST_OK AS testOk, A.XML_INPUTPARAMSAMPLE AS xmlInputParamSample, A.XML_EXPLAIN AS xmlExplain, B.CODE_NM AS codeNm, A.SEND_GUBUN,
			FN_DETAILCODENM(A.SEND_GUBUN) AS sendGubunTxt
		FROM TB_SENDMESSAGETYPR A, LETTCCMMNDETAILCODE B
		WHERE A.WORK_GUBUN = B.CODE 
		AND A.XML_SEQ = #{xmlSeq}
	</select>

	<select id="selectDIDProcessNm" resultType="java.lang.String">
		SELECT XML_PROCESS_NAME
		FROM TB_SENDMESSAGETYPR
		WHERE ETC1 = #{code}
	</select>
	
	<select id="selectXmlrInfoManageNameDetail" resultType="XmlInfoVO">
		SELECT 
			A.XML_SEQ AS xmlSeq, A.WORK_GUBUN AS workGubun, A.XML_PROCESS_NAME AS xmlProcessName, A.PROCESS_REMARK AS processRemark, A.XML_INPUTPARAM AS xmlInputParam,
			A.XML_OTPUTPARAM AS xmlOutputParam, A.RESULT_CODE_EXAMPLE AS resultCodeExample, A.ETC1 AS etc1, A.ETC2 AS etc2, A.ETC3 AS etc3,
			A.TEST_OK AS testOk, A.XML_INPUTPARAMSAMPLE AS xmlInputParamSample, A.XML_EXPLAIN AS xmlExplain, A.SEND_GUBUN, FN_DETAILCODENM(A.SEND_GUBUN) AS sendGubunTxt
		FROM TB_SENDMESSAGETYPR A
		WHERE A.XML_PROCESS_NAME = #{xmlProcessName}
	</select>
	
	<select id="selectXmlProcessCount" resultType="java.lang.Integer">
		SELECT NVL(COUNT(*),0) 
		FROM TB_SENDMESSAGETYPR
		WHERE XML_PROCESS_NAME = #{xmlProcessName}
	</select>
	
	<select id="selectXmlInfoManageListTotCnt_S" resultType="java.lang.Integer">
		SELECT NVL(COUNT(*),0)
		FROM TB_SENDMESSAGETYPR A, LETTCCMMNDETAILCODE B
		WHERE A.WORK_GUBUN = B.CODE
		<if test="searchKeyword != ''">
			<choose>
				<when test="searchCondition == 'xmlProcessName'">
					AND XML_PROCESS_NAME LIKE '%' || #{searchKeyword} || '%'
				</when>
				<otherwise>
					AND PROCESS_REMARK LIKE '%' || #{searchKeyword} || '%'
				</otherwise>
			</choose>
		</if>
		<if test="seachWorkGubun != ''">
			AND A.WORK_GUBUN = #{seachWorkGubun}
		</if>
	</select>
	
	<insert id="insertXmlInfoManage">	
		INSERT INTO TB_SENDMESSAGETYPR 
		(
			XML_SEQ, WORK_GUBUN, SEND_GUBUN, XML_PROCESS_NAME, PROCESS_REMARK,
			XML_INPUTPARAM, XML_OTPUTPARAM, RESULT_CODE_EXAMPLE, ETC1, ETC2, 
			ETC3, TEST_OK, XML_INPUTPARAMSAMPLE, XML_EXPLAIN, FRST_REGIST_PNTTM,
			FRST_REGISTER_ID
		)
		VALUES 
		(
			SQ_MSGSEQ.NEXTVAL, #{workGubun,jdbcType=VARCHAR}, #{sendGubun,jdbcType=VARCHAR}, #{xmlProcessName,jdbcType=VARCHAR}, #{processRemark,jdbcType=VARCHAR},
			#{xmlInputParam,jdbcType=VARCHAR}, #{xmlOutputParam,jdbcType=VARCHAR}, #{resultCodeExample}, #{etc1,jdbcType=VARCHAR}, #{etc2,jdbcType=VARCHAR}, 
			#{etc3,jdbcType=VARCHAR}, #{testOk}, #{xmlInputParamSample,jdbcType=VARCHAR}, #{xmlExplain,jdbcType=VARCHAR}, SYSDATE, 
			#{userId, jdbcType=VARCHAR}
		)
		<selectKey resultType="String" keyProperty="xmlSeq" order="AFTER">
			SELECT TO_CHAR(MAX(XML_SEQ)) FROM TB_SENDMESSAGETYPR
		</selectKey>
	</insert>
	
	<update id="updateXmlInfoManage">
		UPDATE TB_SENDMESSAGETYPR SET 
			WORK_GUBUN = #{workGubun},
			SEND_GUBUN = #{sendGubun,jdbcType=VARCHAR},
			XML_PROCESS_NAME = #{xmlProcessName ,jdbcType=VARCHAR},
			PROCESS_REMARK = #{processRemark,jdbcType=VARCHAR},
			XML_INPUTPARAM = #{xmlInputParam,jdbcType=VARCHAR},
			XML_OTPUTPARAM = #{xmlOutputParam,jdbcType=VARCHAR},
			RESULT_CODE_EXAMPLE = #{resultCodeExample},
			ETC1 = #{etc1,jdbcType=VARCHAR},
			ETC2 = #{etc2,jdbcType=VARCHAR},
			ETC3 = #{etc3,jdbcType=VARCHAR},
			TEST_OK = #{testOk,jdbcType=VARCHAR},
			XML_INPUTPARAMSAMPLE = #{xmlInputParamSample},
			XML_EXPLAIN = #{xmlExplain,jdbcType=VARCHAR}
		WHERE XML_SEQ = #{xmlSeq}
	</update>
	
	<delete id="deleteXmlInfoManage">
		DELETE FROM TB_SENDMESSAGETYPR
		WHERE XML_SEQ = #{xmlSeq}
	</delete>
</mapper>